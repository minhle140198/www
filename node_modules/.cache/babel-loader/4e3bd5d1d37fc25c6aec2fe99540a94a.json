{"ast":null,"code":"import _regeneratorRuntime from\"/Users/monsama/firetable/www/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import React,{useContext,useRef,useEffect}from\"react\";import{createStyles,makeStyles,Theme}from\"@material-ui/core/styles\";import EditorContext from\"contexts/editorContext\";import{FieldType}from\"./Fields\";import ReactQuill,{Quill}from\"react-quill\";import{ImageDrop}from\"quill-image-drop-module\";import Delta from\"quill-delta\";import\"react-quill/dist/quill.snow.css\";import{bucket}from\"../firebase\";import EditorModel from\"./EditorModal\";Quill.register(\"modules/imageDrop\",ImageDrop);var useStyles=makeStyles(function(theme){return createStyles({test:{position:\"absolute\",top:10,left:10},modal:{display:\"flex\",alignItems:\"center\",justifyContent:\"center\",maxWidth:600,width:\"100%\"},paper:{padding:theme.spacing(2)},root:{margin:\"\".concat(theme.spacing(1),\"px 0\"),\"&:focus-within $sectionTitle\":{color:theme.palette.type===\"dark\"?theme.palette.primary.dark:theme.palette.primary.main}},typography:{padding:theme.spacing(2)},textArea:{fontSize:16,minWidth:230,width:\"100%\"},quillEditor:{minHeight:100,// match styling\n\"& .ql-toolbar\":{borderRadius:\"\".concat(theme.shape.borderRadius,\"px \").concat(theme.shape.borderRadius,\"px 0 0\"),transition:theme.transitions.create(\"border-color\",{duration:theme.transitions.duration.shortest})},\"& .ql-container\":{borderRadius:\"0 0 \".concat(theme.shape.borderRadius,\"px \").concat(theme.shape.borderRadius,\"px\"),transition:theme.transitions.create(\"border-color\",{duration:theme.transitions.duration.shortest})},\"& .ql-editor\":{minHeight:100,fontFamily:theme.typography.fontFamily,fontSize:\".875rem\",color:theme.palette.text.primary,\"&.ql-blank::before\":{fontStyle:\"normal\",color:theme.palette.text.disabled}},// highlight border on focus\n\"&:focus-within .ql-toolbar.ql-snow, &:focus-within .ql-container.ql-snow\":{borderColor:theme.palette.primary.main},// buttons stroke/fill colour matching\n\"& .ql-snow.ql-toolbar button, & .ql-snow .ql-picker-label\":{borderRadius:theme.shape.borderRadius/2,transition:theme.transitions.create(\"background-color\",{duration:theme.transitions.duration.shortest})},\"& .ql-snow .ql-stroke\":{stroke:theme.palette.text.primary,transition:theme.transitions.create(\"stroke\",{duration:theme.transitions.duration.shortest})},\"& .ql-snow .ql-fill\":{fill:theme.palette.text.primary,transition:theme.transitions.create(\"fill\",{duration:theme.transitions.duration.shortest})},// colour buttons on hover\n\"& button:hover .ql-stroke\":{stroke:\"\".concat(theme.palette.primary.main,\" !important\")},\"& button:hover .ql-fill\":{fill:\"\".concat(theme.palette.primary.main,\" !important\")},// highlight buttons when selected/active\n\"& .ql-snow.ql-toolbar .ql-active\":{backgroundColor:theme.palette.primary.light,\"& .ql-stroke\":{stroke:\"\".concat(theme.palette.primary.main,\" !important\")},\"& .ql-fill\":{fill:\"\".concat(theme.palette.primary.main,\" !important\")}},// dropdown styling\n\"& .ql-snow.ql-toolbar button:hover, & .ql-snow .ql-toolbar button:hover, & .ql-snow.ql-toolbar button:focus, & .ql-snow .ql-toolbar button:focus, & .ql-snow.ql-toolbar button.ql-active, & .ql-snow .ql-toolbar button.ql-active, & .ql-snow.ql-toolbar .ql-picker-label:hover, & .ql-snow .ql-toolbar .ql-picker-label:hover, & .ql-snow.ql-toolbar .ql-picker-label.ql-active, & .ql-snow .ql-toolbar .ql-picker-label.ql-active, & .ql-snow.ql-toolbar .ql-picker-item:hover, & .ql-snow .ql-toolbar .ql-picker-item:hover, & .ql-snow.ql-toolbar .ql-picker-item.ql-selected, & .ql-snow .ql-toolbar .ql-picker-item.ql-selected\":{color:theme.palette.primary.main,\"& polygon\":{stroke:theme.palette.primary.main+\" !important\"}}}});});function asyncUploader(ref,file){var documentRef,snapShot,downloadUrl;return _regeneratorRuntime.async(function asyncUploader$(_context){while(1){switch(_context.prev=_context.next){case 0:documentRef=bucket.ref(\"RTE\").child(ref);_context.next=3;return _regeneratorRuntime.awrap(documentRef.put(file));case 3:snapShot=_context.sent;_context.next=6;return _regeneratorRuntime.awrap(bucket.ref(\"RTE\").child(snapShot.metadata.fullPath).getDownloadURL());case 6:downloadUrl=_context.sent;return _context.abrupt(\"return\",downloadUrl);case 8:case\"end\":return _context.stop();}}});}var imageHandler=function imageHandler(quillRef){return function(){var now=new Date();var quill=quillRef.current.getEditor();var fileInput=document.body.querySelector(\"input.ql-image[type=file]\");if(fileInput==null){fileInput=document.createElement(\"input\");fileInput.setAttribute(\"type\",\"file\");fileInput.setAttribute(\"accept\",\"image/png, image/gif, image/jpeg, image/bmp, image/x-icon\");fileInput.classList.add(\"ql-image\");fileInput.addEventListener(\"change\",function _callee(){var ref,downloadUrl,range;return _regeneratorRuntime.async(function _callee$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:console.log(\"detected file\");if(!(fileInput.files!=null&&fileInput.files[0]!=null)){_context2.next=11;break;}ref=\"quill-images/\".concat(now.getTime(),\"/\").concat(fileInput.files[0].name);_context2.next=5;return _regeneratorRuntime.awrap(asyncUploader(ref,fileInput.files[0]));case 5:downloadUrl=_context2.sent;console.log(downloadUrl);range=quill.getSelection(true);quill.updateContents(new Delta().retain(range.index).delete(range.length).insert({image:downloadUrl}),\"user\");fileInput.value=\"\";document.body.removeChild(fileInput);case 11:case\"end\":return _context2.stop();}}});});document.body.appendChild(fileInput);}fileInput.click();};};var RichTextEditor=function RichTextEditor(props){var classes=useStyles();var editorContext=useContext(EditorContext);var quillRef=useRef(null);useEffect(function(){if(quillRef.current){quillRef.current.getEditor().getModule(\"toolbar\").addHandler(\"image\",imageHandler(quillRef));}},[quillRef]);if(editorContext.fieldType!==FieldType.richText)return React.createElement(React.Fragment,null);return React.createElement(EditorModel,null,React.createElement(ReactQuill//placeholder={placeholder}\n,{value:editorContext.editorValue,ref:quillRef,onChange:function onChange(val){// const dataURLregEx = /\"data:.*?\"/;\n// let matches = val.match(dataURLregEx);\n// delete matches.index;\n// delete matches.input;\n// delete matches.groups;\n// console.log(matches);\neditorContext.setEditorValue(val);},theme:\"snow\",className:classes.quillEditor//  preserveWhiteSpace\n,modules:{// toolbar: [\n//   ['image']\n// ],\nimageDrop:true,toolbar:{container:[[\"bold\",\"italic\",\"underline\"],[{header:[1,2,3,4,false]}],[{list:\"bullet\"},{list:\"ordered\"}],[{indent:\"-1\"},{indent:\"+1\"}],[\"blockquote\",\"code-block\",\"image\",\"video\"],[\"link\"]]},clipboard:{matchVisual:false}}}));};export default RichTextEditor;","map":{"version":3,"sources":["/Users/monsama/firetable/www/src/components/RichTextEditor.jsx"],"names":["React","useContext","useRef","useEffect","createStyles","makeStyles","Theme","EditorContext","FieldType","ReactQuill","Quill","ImageDrop","Delta","bucket","EditorModel","register","useStyles","theme","test","position","top","left","modal","display","alignItems","justifyContent","maxWidth","width","paper","padding","spacing","root","margin","color","palette","type","primary","dark","main","typography","textArea","fontSize","minWidth","quillEditor","minHeight","borderRadius","shape","transition","transitions","create","duration","shortest","fontFamily","text","fontStyle","disabled","borderColor","stroke","fill","backgroundColor","light","asyncUploader","ref","file","documentRef","child","put","snapShot","metadata","fullPath","getDownloadURL","downloadUrl","imageHandler","quillRef","now","Date","quill","current","getEditor","fileInput","document","body","querySelector","createElement","setAttribute","classList","add","addEventListener","console","log","files","getTime","name","range","getSelection","updateContents","retain","index","delete","length","insert","image","value","removeChild","appendChild","click","RichTextEditor","props","classes","editorContext","getModule","addHandler","fieldType","richText","editorValue","val","setEditorValue","imageDrop","toolbar","container","header","list","indent","clipboard","matchVisual"],"mappings":"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","sourcesContent":["import React, { useContext, useRef, useEffect } from \"react\";\nimport { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\";\nimport EditorContext from \"contexts/editorContext\";\nimport { FieldType } from \"./Fields\";\nimport ReactQuill, { Quill } from \"react-quill\";\nimport { ImageDrop } from \"quill-image-drop-module\";\nimport Delta from \"quill-delta\";\nimport \"react-quill/dist/quill.snow.css\";\nimport { bucket } from \"../firebase\";\n\nimport EditorModel from \"./EditorModal\";\n\nQuill.register(\"modules/imageDrop\", ImageDrop);\n\nconst useStyles = makeStyles(theme =>\n  createStyles({\n    test: { position: \"absolute\", top: 10, left: 10 },\n    modal: {\n      display: \"flex\",\n      alignItems: \"center\",\n      justifyContent: \"center\",\n      maxWidth: 600,\n      width: \"100%\",\n    },\n    paper: { padding: theme.spacing(2) },\n    root: {\n      margin: `${theme.spacing(1)}px 0`,\n\n      \"&:focus-within $sectionTitle\": {\n        color:\n          theme.palette.type === \"dark\"\n            ? theme.palette.primary.dark\n            : theme.palette.primary.main,\n      },\n    },\n    typography: {\n      padding: theme.spacing(2),\n    },\n    textArea: {\n      fontSize: 16,\n      minWidth: 230,\n      width: \"100%\",\n    },\n    quillEditor: {\n      minHeight: 100,\n\n      // match styling\n      \"& .ql-toolbar\": {\n        borderRadius: `${theme.shape.borderRadius}px ${theme.shape.borderRadius}px 0 0`,\n        transition: theme.transitions.create(\"border-color\", {\n          duration: theme.transitions.duration.shortest,\n        }),\n      },\n      \"& .ql-container\": {\n        borderRadius: `0 0 ${theme.shape.borderRadius}px ${theme.shape.borderRadius}px`,\n        transition: theme.transitions.create(\"border-color\", {\n          duration: theme.transitions.duration.shortest,\n        }),\n      },\n      \"& .ql-editor\": {\n        minHeight: 100,\n        fontFamily: theme.typography.fontFamily,\n        fontSize: \".875rem\",\n        color: theme.palette.text.primary,\n        \"&.ql-blank::before\": {\n          fontStyle: \"normal\",\n          color: theme.palette.text.disabled,\n        },\n      },\n\n      // highlight border on focus\n      \"&:focus-within .ql-toolbar.ql-snow, &:focus-within .ql-container.ql-snow\": {\n        borderColor: theme.palette.primary.main,\n      },\n\n      // buttons stroke/fill colour matching\n      \"& .ql-snow.ql-toolbar button, & .ql-snow .ql-picker-label\": {\n        borderRadius: theme.shape.borderRadius / 2,\n        transition: theme.transitions.create(\"background-color\", {\n          duration: theme.transitions.duration.shortest,\n        }),\n      },\n      \"& .ql-snow .ql-stroke\": {\n        stroke: theme.palette.text.primary,\n        transition: theme.transitions.create(\"stroke\", {\n          duration: theme.transitions.duration.shortest,\n        }),\n      },\n      \"& .ql-snow .ql-fill\": {\n        fill: theme.palette.text.primary,\n        transition: theme.transitions.create(\"fill\", {\n          duration: theme.transitions.duration.shortest,\n        }),\n      },\n\n      // colour buttons on hover\n      \"& button:hover .ql-stroke\": {\n        stroke: `${theme.palette.primary.main} !important`,\n      },\n      \"& button:hover .ql-fill\": {\n        fill: `${theme.palette.primary.main} !important`,\n      },\n\n      // highlight buttons when selected/active\n      \"& .ql-snow.ql-toolbar .ql-active\": {\n        backgroundColor: theme.palette.primary.light,\n        \"& .ql-stroke\": {\n          stroke: `${theme.palette.primary.main} !important`,\n        },\n        \"& .ql-fill\": {\n          fill: `${theme.palette.primary.main} !important`,\n        },\n      },\n\n      // dropdown styling\n      \"& .ql-snow.ql-toolbar button:hover, & .ql-snow .ql-toolbar button:hover, & .ql-snow.ql-toolbar button:focus, & .ql-snow .ql-toolbar button:focus, & .ql-snow.ql-toolbar button.ql-active, & .ql-snow .ql-toolbar button.ql-active, & .ql-snow.ql-toolbar .ql-picker-label:hover, & .ql-snow .ql-toolbar .ql-picker-label:hover, & .ql-snow.ql-toolbar .ql-picker-label.ql-active, & .ql-snow .ql-toolbar .ql-picker-label.ql-active, & .ql-snow.ql-toolbar .ql-picker-item:hover, & .ql-snow .ql-toolbar .ql-picker-item:hover, & .ql-snow.ql-toolbar .ql-picker-item.ql-selected, & .ql-snow .ql-toolbar .ql-picker-item.ql-selected\": {\n        color: theme.palette.primary.main,\n\n        \"& polygon\": { stroke: theme.palette.primary.main + \" !important\" },\n      },\n    },\n  })\n);\n\nasync function asyncUploader(ref, file) {\n  const documentRef = bucket.ref(\"RTE\").child(ref);\n  const snapShot = await documentRef.put(file);\n  const downloadUrl = await bucket\n    .ref(\"RTE\")\n    .child(snapShot.metadata.fullPath)\n    .getDownloadURL();\n  return downloadUrl;\n}\nconst imageHandler = quillRef => () => {\n  const now = new Date();\n  const quill = quillRef.current.getEditor();\n  let fileInput = document.body.querySelector(\"input.ql-image[type=file]\");\n  if (fileInput == null) {\n    fileInput = document.createElement(\"input\");\n    fileInput.setAttribute(\"type\", \"file\");\n    fileInput.setAttribute(\n      \"accept\",\n      \"image/png, image/gif, image/jpeg, image/bmp, image/x-icon\"\n    );\n    fileInput.classList.add(\"ql-image\");\n    fileInput.addEventListener(\"change\", async () => {\n      console.log(\"detected file\");\n      if (fileInput.files != null && fileInput.files[0] != null) {\n        const ref = `quill-images/${now.getTime()}/${fileInput.files[0].name}`;\n        const downloadUrl = await asyncUploader(ref, fileInput.files[0]);\n        console.log(downloadUrl);\n        let range = quill.getSelection(true);\n        quill.updateContents(\n          new Delta()\n            .retain(range.index)\n            .delete(range.length)\n            .insert({ image: downloadUrl }),\n          \"user\"\n        );\n\n        fileInput.value = \"\";\n        document.body.removeChild(fileInput);\n      }\n    });\n    document.body.appendChild(fileInput);\n  }\n  fileInput.click();\n};\n\nconst RichTextEditor = props => {\n  const classes = useStyles();\n  const editorContext = useContext(EditorContext);\n  const quillRef = useRef(null);\n  useEffect(() => {\n    if (quillRef.current) {\n      quillRef.current\n        .getEditor()\n        .getModule(\"toolbar\")\n        .addHandler(\"image\", imageHandler(quillRef));\n    }\n  }, [quillRef]);\n  if (editorContext.fieldType !== FieldType.richText) return <></>;\n  return (\n    <EditorModel>\n      <ReactQuill\n        //placeholder={placeholder}\n        value={editorContext.editorValue}\n        ref={quillRef}\n        onChange={val => {\n          // const dataURLregEx = /\"data:.*?\"/;\n          // let matches = val.match(dataURLregEx);\n          // delete matches.index;\n          // delete matches.input;\n          // delete matches.groups;\n          // console.log(matches);\n          editorContext.setEditorValue(val);\n        }}\n        theme=\"snow\"\n        className={classes.quillEditor}\n        //  preserveWhiteSpace\n        modules={{\n          // toolbar: [\n          //   ['image']\n          // ],\n          imageDrop: true,\n          toolbar: {\n            container: [\n              [\"bold\", \"italic\", \"underline\"],\n              [{ header: [1, 2, 3, 4, false] }],\n              [{ list: \"bullet\" }, { list: \"ordered\" }],\n              [{ indent: \"-1\" }, { indent: \"+1\" }],\n              [\"blockquote\", \"code-block\", \"image\", \"video\"],\n              [\"link\"],\n            ],\n          },\n          clipboard: {\n            matchVisual: false,\n          },\n        }}\n      />\n    </EditorModel>\n  );\n};\nexport default RichTextEditor;\n"]},"metadata":{},"sourceType":"module"}