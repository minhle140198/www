{"ast":null,"code":"import _slicedToArray from\"/Users/monsama/firetable/www/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useCallback}from\"react\";import{useDropzone}from\"react-dropzone\";import useUploader from\"../../hooks/useFiretable/useUploader\";import Chip from\"@material-ui/core/Chip\";import{createStyles,makeStyles}from\"@material-ui/core/styles\";import IconButton from\"@material-ui/core/IconButton\";import AddIcon from\"@material-ui/icons/NoteAdd\";import _findIndex from\"lodash/findIndex\";// TODO:  indicate state error\nvar useStyles=makeStyles(function(theme){return createStyles({root:{display:\"flex\",// flexDirection: \"column\",\nalignContent:\"center\",width:\"100%\"},chip:{margin:theme.spacing(5),maxWidth:200},progress:{margin:theme.spacing(5)},addIcon:{maxHeight:48}});});var File=function File(props){var fieldName=props.fieldName,value=props.value,row=props.row,onSubmit=props.onSubmit,config=props.config;var classes=useStyles();var _useUploader=useUploader(),_useUploader2=_slicedToArray(_useUploader,2),uploaderState=_useUploader2[0],upload=_useUploader2[1];var progress=uploaderState.progress;var onDrop=useCallback(function(acceptedFiles){// Do something with the files\nvar imageFile=acceptedFiles[0];if(imageFile){upload(row.ref,fieldName,[imageFile],value);}},[]);var _useDropzone=useDropzone({onDrop:onDrop,multiple:false}),getRootProps=_useDropzone.getRootProps,getInputProps=_useDropzone.getInputProps,isDragActive=_useDropzone.isDragActive;var handleDelete=function handleDelete(downloadURL){var index=_findIndex(value,[\"downloadURL\",downloadURL]);value.splice(index,1);onSubmit(value);};var dropzoneProps=getRootProps();return React.createElement(\"div\",Object.assign({className:classes.root},dropzoneProps,{onClick:function onClick(){}}),React.createElement(\"input\",getInputProps()),value&&value.map(function(file){return React.createElement(Chip,{key:file.name,label:file.name,className:classes.chip,onClick:function onClick(){window.open(file.downloadURL);},onDelete:config&&config.isLocked?undefined:function(){handleDelete(file.downloadURL);}});}),config&&config.isLocked?React.createElement(React.Fragment,null):React.createElement(IconButton,{className:classes.addIcon,onClick:dropzoneProps.onClick},React.createElement(AddIcon,null)));};export default File;","map":{"version":3,"sources":["/Users/monsama/firetable/www/src/components/Fields/File.tsx"],"names":["React","useCallback","useDropzone","useUploader","Chip","createStyles","makeStyles","IconButton","AddIcon","_findIndex","useStyles","theme","root","display","alignContent","width","chip","margin","spacing","maxWidth","progress","addIcon","maxHeight","File","props","fieldName","value","row","onSubmit","config","classes","uploaderState","upload","onDrop","acceptedFiles","imageFile","ref","multiple","getRootProps","getInputProps","isDragActive","handleDelete","downloadURL","index","splice","dropzoneProps","map","file","name","window","open","isLocked","undefined","onClick"],"mappings":"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","sourcesContent":["import React, { useCallback } from \"react\";\nimport { useDropzone } from \"react-dropzone\";\nimport useUploader from \"../../hooks/useFiretable/useUploader\";\n\nimport { FieldType } from \".\";\nimport Chip from \"@material-ui/core/Chip\";\nimport { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport AddIcon from \"@material-ui/icons/NoteAdd\";\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\nimport _findIndex from \"lodash/findIndex\";\n\n// TODO:  indicate state error\n\ninterface Props {\n  value: { name: string; downloadURL: string }[];\n  row: { ref: firebase.firestore.DocumentReference; id: string };\n  onSubmit: Function;\n  fieldType: FieldType;\n  fieldName: string;\n  config: any;\n}\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      display: \"flex\",\n      // flexDirection: \"column\",\n      alignContent: \"center\",\n      width: \"100%\",\n    },\n    chip: { margin: theme.spacing(5), maxWidth: 200 },\n    progress: { margin: theme.spacing(5) },\n    addIcon: {\n      maxHeight: 48,\n    },\n  })\n);\n\nconst File = (props: Props) => {\n  const { fieldName, value, row, onSubmit, config } = props;\n  const classes = useStyles();\n  const [uploaderState, upload] = useUploader();\n  const { progress } = uploaderState;\n  const onDrop = useCallback(acceptedFiles => {\n    // Do something with the files\n    const imageFile = acceptedFiles[0];\n    if (imageFile) {\n      upload(row.ref, fieldName, [imageFile], value);\n    }\n  }, []);\n\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\n    onDrop,\n    multiple: false,\n  });\n  const handleDelete = (downloadURL: string) => {\n    const index = _findIndex(value, [\"downloadURL\", downloadURL]);\n    value.splice(index, 1);\n    onSubmit(value);\n  };\n  const dropzoneProps = getRootProps();\n  return (\n    <div className={classes.root} {...dropzoneProps} onClick={() => {}}>\n      <input {...getInputProps()} />\n      {value &&\n        value.map((file: any) => {\n          return (\n            <Chip\n              key={file.name}\n              label={file.name}\n              className={classes.chip}\n              onClick={() => {\n                window.open(file.downloadURL);\n              }}\n              onDelete={\n                config && config.isLocked\n                  ? undefined\n                  : () => {\n                      handleDelete(file.downloadURL);\n                    }\n              }\n            />\n          );\n        })}\n\n      {config && config.isLocked ? (\n        <></>\n      ) : (\n        <IconButton className={classes.addIcon} onClick={dropzoneProps.onClick}>\n          <AddIcon />\n        </IconButton>\n      )}\n    </div>\n  );\n};\nexport default File;\n"]},"metadata":{},"sourceType":"module"}