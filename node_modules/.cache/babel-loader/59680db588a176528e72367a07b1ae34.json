{"ast":null,"code":"import _toConsumableArray from\"/Users/monsama/firetable/www/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/monsama/firetable/www/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useCallback,useState}from\"react\";import{useDropzone}from\"react-dropzone\";import useUploader from\"../../hooks/useFiretable/useUploader\";import DeleteIcon from\"@material-ui/icons/Delete\";import{makeStyles,createStyles}from\"@material-ui/core/styles\";import IconButton from\"@material-ui/core/IconButton\";import Grid from\"@material-ui/core/Grid\";import AddIcon from\"@material-ui/icons/AddAPhoto\";import CircularProgress from\"@material-ui/core/CircularProgress\";import _findIndex from\"lodash/findIndex\";import{Tooltip}from\"@material-ui/core\";import Confirmation from\"../Confirmation\";// TODO:  indicate error state\nvar useStyles=makeStyles(function(theme){return createStyles({root:{display:\"flex\",// flexDirection: \"row\",\nalignContent:\"center\",width:\"100%\"},uploadingContainer:{display:\"flex\",alignContent:\"center\",flexDirection:\"row\",justifyContent:\"space-between\"},progress:{margin:theme.spacing(3)},imgHover:{\"&:hover\":{borderStyle:\"solid\",borderColor:\"rgb(255, 0, 0,0.6)\"}},addIcon:{maxHeight:48}});});var Image=function Image(props){var classes=useStyles();var fieldName=props.fieldName,value=props.value,row=props.row,onSubmit=props.onSubmit;var _useUploader=useUploader(),_useUploader2=_slicedToArray(_useUploader,2),uploaderState=_useUploader2[0],upload=_useUploader2[1];var progress=uploaderState.progress;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),localImage=_useState2[0],setLocalImage=_useState2[1];var onDrop=useCallback(function(acceptedFiles){// Do something with the files\nvar imageFile=acceptedFiles[0];if(imageFile){upload(row.ref,fieldName,[imageFile],value);var url=URL.createObjectURL(imageFile);setLocalImage(url);}},[]);var _useDropzone=useDropzone({onDrop:onDrop,multiple:false,accept:[\"image/png\",\"image/jpg\",\"image/jpeg\"]}),getRootProps=_useDropzone.getRootProps,getInputProps=_useDropzone.getInputProps,isDragActive=_useDropzone.isDragActive;var dropzoneProps=getRootProps();var files=_toConsumableArray(value);if(localImage){files.push({downloadURL:localImage,name:\"localImage\"});}return React.createElement(Grid,Object.assign({className:classes.root},dropzoneProps,{onClick:function onClick(){}}),React.createElement(\"input\",getInputProps()),value&&files.map(function(file){return React.createElement(Tooltip,{title:\"Click to delete\",key:file.downloadURL},React.createElement(Confirmation,{message:{title:\"Delete Image\",body:\"Are you sure you want to delete this image?\",confirm:React.createElement(React.Fragment,null,React.createElement(DeleteIcon,null),\" Delete\")}},React.createElement(\"div\",{onClick:function onClick(e){var index=_findIndex(value,[\"downloadURL\",file.downloadURL]);value.splice(index,1);onSubmit(value);}},React.createElement(\"img\",{className:classes.imgHover,key:file.name,style:{padding:\"\".concat(row.rowHeight*0.03,\"px\"),height:\"\".concat(row.rowHeight*0.95,\"px\")},src:file.downloadURL}))));}),progress===0?React.createElement(IconButton,{className:classes.addIcon,onClick:dropzoneProps.onClick},React.createElement(AddIcon,null)):React.createElement(\"div\",{className:classes.progress},React.createElement(CircularProgress,{size:row.rowHeight*0.5,variant:\"determinate\",value:progress,color:\"secondary\"})));};export default Image;","map":{"version":3,"sources":["/Users/monsama/firetable/www/src/components/Fields/Image.tsx"],"names":["React","useCallback","useState","useDropzone","useUploader","DeleteIcon","makeStyles","createStyles","IconButton","Grid","AddIcon","CircularProgress","_findIndex","Tooltip","Confirmation","useStyles","theme","root","display","alignContent","width","uploadingContainer","flexDirection","justifyContent","progress","margin","spacing","imgHover","borderStyle","borderColor","addIcon","maxHeight","Image","props","classes","fieldName","value","row","onSubmit","uploaderState","upload","localImage","setLocalImage","onDrop","acceptedFiles","imageFile","ref","url","URL","createObjectURL","multiple","accept","getRootProps","getInputProps","isDragActive","dropzoneProps","files","push","downloadURL","name","map","file","title","body","confirm","e","index","splice","padding","rowHeight","height","onClick"],"mappings":"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","sourcesContent":["import React, { useCallback, useState } from \"react\";\nimport { useDropzone } from \"react-dropzone\";\nimport useUploader from \"../../hooks/useFiretable/useUploader\";\nimport DeleteIcon from \"@material-ui/icons/Delete\";\n\nimport { makeStyles, Theme, createStyles } from \"@material-ui/core/styles\";\nimport { FieldType } from \".\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport Grid from \"@material-ui/core/Grid\";\nimport AddIcon from \"@material-ui/icons/AddAPhoto\";\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\n\nimport _findIndex from \"lodash/findIndex\";\nimport { Tooltip } from \"@material-ui/core\";\nimport Confirmation from \"../Confirmation\";\n// TODO:  indicate error state\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      display: \"flex\",\n      // flexDirection: \"row\",\n      alignContent: \"center\",\n      width: \"100%\",\n    },\n    uploadingContainer: {\n      display: \"flex\",\n      alignContent: \"center\",\n      flexDirection: \"row\",\n      justifyContent: \"space-between\",\n    },\n    progress: {\n      margin: theme.spacing(3),\n    },\n    imgHover: {\n      \"&:hover\": {\n        borderStyle: \"solid\",\n        borderColor: \"rgb(255, 0, 0,0.6)\",\n      },\n    },\n    addIcon: {\n      maxHeight: 48,\n    },\n  })\n);\n\ninterface Props {\n  value: any;\n  row: {\n    ref: firebase.firestore.DocumentReference;\n    id: string;\n    rowHeight: number;\n  };\n  onSubmit: Function;\n  fieldType: FieldType;\n  fieldName: string;\n}\n\nconst Image = (props: Props) => {\n  const classes = useStyles();\n  const { fieldName, value, row, onSubmit } = props;\n  const [uploaderState, upload] = useUploader();\n  const { progress } = uploaderState;\n  const [localImage, setLocalImage] = useState<string | null>(null);\n  const onDrop = useCallback(acceptedFiles => {\n    // Do something with the files\n    const imageFile = acceptedFiles[0];\n    if (imageFile) {\n      upload(row.ref, fieldName, [imageFile], value);\n      let url = URL.createObjectURL(imageFile);\n      setLocalImage(url);\n    }\n  }, []);\n\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\n    onDrop,\n    multiple: false,\n    accept: [\"image/png\", \"image/jpg\", \"image/jpeg\"],\n  });\n  const dropzoneProps = getRootProps();\n\n  const files = [...value];\n  if (localImage) {\n    files.push({ downloadURL: localImage, name: \"localImage\" });\n  }\n  return (\n    <Grid className={classes.root} {...dropzoneProps} onClick={() => {}}>\n      <input {...getInputProps()} />\n      {value &&\n        files.map((file: { name: string; downloadURL: string }) => (\n          <Tooltip title=\"Click to delete\" key={file.downloadURL}>\n            <Confirmation\n              message={{\n                title: \"Delete Image\",\n                body: \"Are you sure you want to delete this image?\",\n                confirm: (\n                  <>\n                    <DeleteIcon /> Delete\n                  </>\n                ),\n              }}\n            >\n              <div\n                onClick={e => {\n                  const index = _findIndex(value, [\n                    \"downloadURL\",\n                    file.downloadURL,\n                  ]);\n                  value.splice(index, 1);\n                  onSubmit(value);\n                }}\n              >\n                <img\n                  className={classes.imgHover}\n                  key={file.name}\n                  style={{\n                    padding: `${row.rowHeight * 0.03}px`,\n                    height: `${row.rowHeight * 0.95}px`,\n                  }}\n                  src={file.downloadURL}\n                />\n              </div>\n            </Confirmation>\n          </Tooltip>\n        ))}\n      {progress === 0 ? (\n        <IconButton className={classes.addIcon} onClick={dropzoneProps.onClick}>\n          <AddIcon />\n        </IconButton>\n      ) : (\n        <div className={classes.progress}>\n          <CircularProgress\n            size={row.rowHeight * 0.5}\n            variant=\"determinate\"\n            value={progress}\n            color=\"secondary\"\n          />\n        </div>\n      )}\n    </Grid>\n  );\n};\nexport default Image;\n"]},"metadata":{},"sourceType":"module"}