{"ast":null,"code":"import _objectSpread from\"/Users/monsama/firetable/www/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/monsama/firetable/www/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import _find from\"lodash/find\";import{makeStyles,createStyles,Popover,Button,Typography,IconButton,Grid,MenuItem,TextField}from\"@material-ui/core\";import FilterIcon from\"@material-ui/icons/FilterList\";import CloseIcon from\"@material-ui/icons/Close\";import MultiSelect from\"../../MultiSelect\";import{FieldType}from\"../../Fields\";var OPERATORS=[{value:\"==\",label:\"Equals\",compatibleTypes:[FieldType.PhoneNumber,FieldType.color,FieldType.date,FieldType.dateTime,FieldType.simpleText,FieldType.singleSelect,FieldType.url,FieldType.email]},{value:\"in\",label:\"matches any of\",compatibleTypes:[FieldType.singleSelect]},{value:\"array-contains\",label:\"Has\",compatibleTypes:[FieldType.multiSelect]},{value:\"array-contains-any\",label:\"Has any\",compatibleTypes:[FieldType.multiSelect]},{value:\"<\",label:\"<\",compatibleTypes:[FieldType.number]},{value:\"<=\",label:\"<=\",compatibleTypes:[FieldType.number]},{value:\">=\",label:\">=\",compatibleTypes:[FieldType.number]},{value:\">\",label:\">\",compatibleTypes:[FieldType.number]},{value:\"<\",label:\"before\",compatibleTypes:[FieldType.date,FieldType.dateTime]},{value:\">=\",label:\"after\",compatibleTypes:[FieldType.date,FieldType.dateTime]}];var useStyles=makeStyles(function(theme){return createStyles({paper:{width:640},closeButton:{position:\"absolute\",top:theme.spacing(0.5),right:theme.spacing(0.5)},content:{padding:theme.spacing(4)},topRow:{marginBottom:theme.spacing(3.5)},bottomButtons:{marginTop:theme.spacing(4.5)}});});var Filters=function Filters(_ref){var _ref2;var columns=_ref.columns,setFilters=_ref.setFilters;//const filters = [{}, {}];\nvar filterColumns=columns.filter(function(c){return c.type!==FieldType.file&&c.type!==FieldType.image;}).map(function(c){return{key:c.key,label:c.name,type:c.type,options:c.options};});filterColumns.pop();// remove the new column\nvar classes=useStyles();var filters=[];var combineType=\"all\";var _useState=useState(),_useState2=_slicedToArray(_useState,2),selectedColumn=_useState2[0],setSelectedColumn=_useState2[1];var _useState3=useState({key:\"\",operator:\"\",value:\"\"}),_useState4=_slicedToArray(_useState3,2),query=_useState4[0],setQuery=_useState4[1];useEffect(function(){if(selectedColumn){var updatedQuery={key:selectedColumn.key,operator:\"\",value:\"\"};if([FieldType.PhoneNumber,FieldType.simpleText,FieldType.url,FieldType.email].includes(selectedColumn.type)){updatedQuery=_objectSpread({},updatedQuery,{operator:\"==\"});}setQuery(updatedQuery);}},[selectedColumn]);var operators=selectedColumn?OPERATORS.filter(function(operator){return operator.compatibleTypes.includes(selectedColumn.type);}):[];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),anchorEl=_useState6[0],setAnchorEl=_useState6[1];var handleClose=function handleClose(){return setAnchorEl(null);};var handleClick=function handleClick(event){setAnchorEl(anchorEl?null:event.currentTarget);};var handleChangeColumn=function handleChangeColumn(e){var column=_find(filterColumns,function(c){return c.key===e.target.value;});setSelectedColumn(column);};var open=Boolean(anchorEl);var id=open?\"simple-popper\":undefined;var renderInputField=function renderInputField(selectedColumn,operator){console.log(\"selectedColumn.fieldType\",selectedColumn.type);switch(selectedColumn.type){case FieldType.email:case FieldType.PhoneNumber:case FieldType.simpleText:case FieldType.longText:return React.createElement(TextField,{onChange:function onChange(e){var value=e.target.value;if(value)setQuery(function(query){return _objectSpread({},query,{value:value});});},variant:\"filled\",hiddenLabel:true,placeholder:\"Text value\"});case FieldType.singleSelect:var val=(query===null||query===void 0?void 0:query.value)?Array.isArray(query.value)?query.value:[query.value]:[];return React.createElement(MultiSelect,{onChange:function onChange(fieldName,value){if(operator===\"==\")setQuery(function(query){return _objectSpread({},query,{value:value[0]});});else setQuery(function(query){return _objectSpread({},query,{value:value});});},options:selectedColumn.options,label:\"\",field:\"\",value:val,multiple:operator===\"in\",TextFieldProps:{hiddenLabel:true}});default:return React.createElement(React.Fragment,null,\"Not available\");// return <TextField variant=\"filled\" fullWidth disabled />;\nbreak;}};return React.createElement(React.Fragment,null,React.createElement(Button,{variant:\"outlined\",color:\"primary\",onClick:handleClick,startIcon:React.createElement(FilterIcon,null)},filters.length!==0&&filters.length,\" Filters\"),React.createElement(Popover,{id:id,open:open,anchorEl:anchorEl,classes:{paper:classes.paper},onClose:handleClose,anchorOrigin:{vertical:\"bottom\",horizontal:\"right\"},transformOrigin:{vertical:\"top\",horizontal:\"right\"}},React.createElement(IconButton,{className:classes.closeButton,onClick:handleClose},React.createElement(CloseIcon,null)),React.createElement(\"div\",{className:classes.content},React.createElement(Grid,{container:true,spacing:2},React.createElement(Grid,{item:true,xs:4},React.createElement(Typography,{variant:\"overline\"},\"Column\")),React.createElement(Grid,{item:true,xs:4},React.createElement(Typography,{variant:\"overline\"},\"Condition\")),React.createElement(Grid,{item:true,xs:4},React.createElement(Typography,{variant:\"overline\"},\"Value\"))),React.createElement(Grid,{container:true,spacing:2},React.createElement(Grid,{item:true,xs:4},React.createElement(TextField,{select:true,variant:\"filled\",hiddenLabel:true,fullWidth:true,value:(_ref2=selectedColumn===null||selectedColumn===void 0?void 0:selectedColumn.key)!==null&&_ref2!==void 0?_ref2:\"\",onChange:handleChangeColumn,SelectProps:{displayEmpty:true}},React.createElement(MenuItem,{disabled:true,value:\"\",style:{display:\"none\"}},\"Select Column\"),filterColumns.map(function(c){return React.createElement(MenuItem,{value:c.key},c.label);}))),React.createElement(Grid,{item:true,xs:4},React.createElement(TextField,{select:true,variant:\"filled\",hiddenLabel:true,fullWidth:true,value:query.operator,disabled:!query.key||(operators===null||operators===void 0?void 0:operators.length)===0,onChange:function onChange(e){setQuery(function(query){return _objectSpread({},query,{operator:e.target.value});});},SelectProps:{displayEmpty:true}},React.createElement(MenuItem,{disabled:true,value:\"\",style:{display:\"none\"}},\"Select Condition\"),operators.map(function(operator){return React.createElement(MenuItem,{value:operator.value},operator.label);}))),React.createElement(Grid,{item:true,xs:4},query.operator&&renderInputField(selectedColumn,query.operator))),React.createElement(Grid,{container:true,className:classes.bottomButtons,justify:\"space-between\"},React.createElement(Button,{disabled:query.key==\"\",color:\"secondary\",onClick:function onClick(){setFilters([]);setQuery({key:\"\",operator:\"\",value:\"\"});setSelectedColumn(null);//handleClose();\n}},\"Clear\"),React.createElement(Button,{disabled:query.value==\"\",color:\"primary\",onClick:function onClick(){setFilters([query]);handleClose();}},\"Apply\")))));};export default Filters;","map":{"version":3,"sources":["/Users/monsama/firetable/www/src/components/Table/Filters/index.tsx"],"names":["React","useState","useEffect","_find","makeStyles","createStyles","Popover","Button","Typography","IconButton","Grid","MenuItem","TextField","FilterIcon","CloseIcon","MultiSelect","FieldType","OPERATORS","value","label","compatibleTypes","PhoneNumber","color","date","dateTime","simpleText","singleSelect","url","email","multiSelect","number","useStyles","theme","paper","width","closeButton","position","top","spacing","right","content","padding","topRow","marginBottom","bottomButtons","marginTop","Filters","columns","setFilters","filterColumns","filter","c","type","file","image","map","key","name","options","pop","classes","filters","combineType","selectedColumn","setSelectedColumn","operator","query","setQuery","updatedQuery","includes","operators","anchorEl","setAnchorEl","handleClose","handleClick","event","currentTarget","handleChangeColumn","e","column","target","open","Boolean","id","undefined","renderInputField","console","log","longText","val","Array","isArray","fieldName","hiddenLabel","length","vertical","horizontal","displayEmpty","display"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport _find from \"lodash/find\";\n\nimport {\n  makeStyles,\n  createStyles,\n  Popover,\n  Button,\n  Typography,\n  IconButton,\n  FormControl,\n  Grid,\n  Select,\n  MenuItem,\n  TextField,\n} from \"@material-ui/core\";\nimport FilterIcon from \"@material-ui/icons/FilterList\";\nimport CloseIcon from \"@material-ui/icons/Close\";\n\nimport MultiSelect from \"../../MultiSelect\";\n\nimport { FieldType } from \"../../Fields\";\nimport { FireTableFilter } from \"../../../hooks/useFiretable\";\n\nconst OPERATORS = [\n  {\n    value: \"==\",\n    label: \"Equals\",\n    compatibleTypes: [\n      FieldType.PhoneNumber,\n      FieldType.color,\n      FieldType.date,\n      FieldType.dateTime,\n      FieldType.simpleText,\n      FieldType.singleSelect,\n      FieldType.url,\n      FieldType.email,\n    ],\n  },\n  {\n    value: \"in\",\n    label: \"matches any of\",\n    compatibleTypes: [FieldType.singleSelect],\n  },\n  {\n    value: \"array-contains\",\n    label: \"Has\",\n    compatibleTypes: [FieldType.multiSelect],\n  },\n  {\n    value: \"array-contains-any\",\n    label: \"Has any\",\n    compatibleTypes: [FieldType.multiSelect],\n  },\n  { value: \"<\", label: \"<\", compatibleTypes: [FieldType.number] },\n  { value: \"<=\", label: \"<=\", compatibleTypes: [FieldType.number] },\n  { value: \">=\", label: \">=\", compatibleTypes: [FieldType.number] },\n  { value: \">\", label: \">\", compatibleTypes: [FieldType.number] },\n  {\n    value: \"<\",\n    label: \"before\",\n    compatibleTypes: [FieldType.date, FieldType.dateTime],\n  },\n  {\n    value: \">=\",\n    label: \"after\",\n    compatibleTypes: [FieldType.date, FieldType.dateTime],\n  },\n];\n\nconst useStyles = makeStyles(theme =>\n  createStyles({\n    paper: { width: 640 },\n\n    closeButton: {\n      position: \"absolute\",\n      top: theme.spacing(0.5),\n      right: theme.spacing(0.5),\n    },\n\n    content: { padding: theme.spacing(4) },\n\n    topRow: { marginBottom: theme.spacing(3.5) },\n    bottomButtons: { marginTop: theme.spacing(4.5) },\n  })\n);\n\nconst Filters = ({ columns, setFilters }: any) => {\n  //const filters = [{}, {}];\n\n  const filterColumns = columns\n    .filter(c => c.type !== FieldType.file && c.type !== FieldType.image)\n    .map(c => ({\n      key: c.key,\n      label: c.name,\n      type: c.type,\n      options: c.options,\n    }));\n  filterColumns.pop(); // remove the new column\n\n  const classes = useStyles();\n  const filters = [];\n  const combineType = \"all\";\n  const [selectedColumn, setSelectedColumn] = useState<any>();\n\n  const [query, setQuery] = useState<FireTableFilter>({\n    key: \"\",\n    operator: \"\",\n    value: \"\",\n  });\n\n  useEffect(() => {\n    if (selectedColumn) {\n      let updatedQuery = { key: selectedColumn.key, operator: \"\", value: \"\" };\n      if (\n        [\n          FieldType.PhoneNumber,\n          FieldType.simpleText,\n          FieldType.url,\n          FieldType.email,\n        ].includes(selectedColumn.type)\n      ) {\n        updatedQuery = { ...updatedQuery, operator: \"==\" };\n      }\n      setQuery(updatedQuery);\n    }\n  }, [selectedColumn]);\n\n  const operators = selectedColumn\n    ? OPERATORS.filter(operator =>\n        operator.compatibleTypes.includes(selectedColumn.type)\n      )\n    : [];\n\n  const [anchorEl, setAnchorEl] = useState<null | HTMLElement>(null);\n  const handleClose = () => setAnchorEl(null);\n\n  const handleClick = (event: React.MouseEvent<HTMLElement>) => {\n    setAnchorEl(anchorEl ? null : event.currentTarget);\n  };\n\n  const handleChangeColumn = e => {\n    const column = _find(filterColumns, c => c.key === e.target.value);\n    setSelectedColumn(column);\n  };\n  const open = Boolean(anchorEl);\n\n  const id = open ? \"simple-popper\" : undefined;\n\n  const renderInputField = (selectedColumn, operator) => {\n    console.log(\"selectedColumn.fieldType\", selectedColumn.type);\n    switch (selectedColumn.type) {\n      case FieldType.email:\n      case FieldType.PhoneNumber:\n      case FieldType.simpleText:\n      case FieldType.longText:\n        return (\n          <TextField\n            onChange={e => {\n              const value = e.target.value;\n              if (value) setQuery(query => ({ ...query, value: value }));\n            }}\n            variant=\"filled\"\n            hiddenLabel\n            placeholder=\"Text value\"\n          />\n        );\n\n      case FieldType.singleSelect:\n        const val = query?.value\n          ? Array.isArray(query.value)\n            ? query.value\n            : [query.value as string]\n          : [];\n\n        return (\n          <MultiSelect\n            onChange={(fieldName, value) => {\n              if (operator === \"==\")\n                setQuery(query => ({ ...query, value: value[0] }));\n              else setQuery(query => ({ ...query, value }));\n            }}\n            options={selectedColumn.options}\n            label=\"\"\n            field=\"\"\n            value={val}\n            multiple={operator === \"in\"}\n            TextFieldProps={{ hiddenLabel: true }}\n          />\n        );\n\n      default:\n        return <>Not available</>;\n        // return <TextField variant=\"filled\" fullWidth disabled />;\n        break;\n    }\n  };\n  return (\n    <>\n      <Button\n        variant=\"outlined\"\n        color=\"primary\"\n        onClick={handleClick}\n        startIcon={<FilterIcon />}\n      >\n        {filters.length !== 0 && filters.length}\n        {` Filters`}\n      </Button>\n\n      <Popover\n        id={id}\n        open={open}\n        anchorEl={anchorEl}\n        classes={{ paper: classes.paper }}\n        onClose={handleClose}\n        anchorOrigin={{ vertical: \"bottom\", horizontal: \"right\" }}\n        transformOrigin={{ vertical: \"top\", horizontal: \"right\" }}\n      >\n        <IconButton className={classes.closeButton} onClick={handleClose}>\n          <CloseIcon />\n        </IconButton>\n\n        <div className={classes.content}>\n          {/* <Grid\n            container\n            alignItems=\"center\"\n            spacing={2}\n            className={classes.topRow}\n          >\n            <Grid item>\n              <Typography component=\"span\">Results match</Typography>\n            </Grid>\n\n            <Grid item>\n              <TextField\n                select\n                variant=\"filled\"\n                id=\"demo-simple-select-filled\"\n                value={combineType}\n                hiddenLabel\n                // disabled\n                // onChange={handleChange}\n              >\n                <MenuItem value=\"all\">all</MenuItem>\n                <MenuItem value=\"any\">any</MenuItem>\n              </TextField>\n            </Grid>\n\n            <Grid item>\n              <Typography component=\"span\">of the filter criteria.</Typography>\n            </Grid>\n          </Grid> */}\n\n          <Grid container spacing={2}>\n            <Grid item xs={4}>\n              <Typography variant=\"overline\">Column</Typography>\n            </Grid>\n            <Grid item xs={4}>\n              <Typography variant=\"overline\">Condition</Typography>\n            </Grid>\n            <Grid item xs={4}>\n              <Typography variant=\"overline\">Value</Typography>\n            </Grid>\n          </Grid>\n\n          <Grid container spacing={2}>\n            <Grid item xs={4}>\n              <TextField\n                select\n                variant=\"filled\"\n                hiddenLabel\n                fullWidth\n                value={selectedColumn?.key ?? \"\"}\n                onChange={handleChangeColumn}\n                SelectProps={{ displayEmpty: true }}\n              >\n                <MenuItem disabled value=\"\" style={{ display: \"none\" }}>\n                  Select Column\n                </MenuItem>\n                {filterColumns.map(c => (\n                  <MenuItem value={c.key}>{c.label}</MenuItem>\n                ))}\n              </TextField>\n            </Grid>\n\n            <Grid item xs={4}>\n              <TextField\n                select\n                variant=\"filled\"\n                hiddenLabel\n                fullWidth\n                value={query.operator}\n                disabled={!query.key || operators?.length === 0}\n                onChange={e => {\n                  setQuery(query => ({\n                    ...query,\n                    operator: e.target.value as string,\n                  }));\n                }}\n                SelectProps={{ displayEmpty: true }}\n              >\n                <MenuItem disabled value=\"\" style={{ display: \"none\" }}>\n                  Select Condition\n                </MenuItem>\n                {operators.map(operator => (\n                  <MenuItem value={operator.value}>{operator.label}</MenuItem>\n                ))}\n              </TextField>\n            </Grid>\n\n            <Grid item xs={4}>\n              {query.operator &&\n                renderInputField(selectedColumn, query.operator)}\n            </Grid>\n          </Grid>\n\n          <Grid\n            container\n            className={classes.bottomButtons}\n            justify=\"space-between\"\n          >\n            {/* <Button color=\"primary\">+ ADD FILTER</Button> */}\n            <Button\n              disabled={query.key == \"\"}\n              color=\"secondary\"\n              onClick={() => {\n                setFilters([]);\n                setQuery({\n                  key: \"\",\n                  operator: \"\",\n                  value: \"\",\n                });\n                setSelectedColumn(null);\n                //handleClose();\n              }}\n            >\n              Clear\n            </Button>\n            <Button\n              disabled={query.value == \"\"}\n              color=\"primary\"\n              onClick={() => {\n                setFilters([query]);\n                handleClose();\n              }}\n            >\n              Apply\n            </Button>\n          </Grid>\n        </div>\n      </Popover>\n    </>\n  );\n};\n\nexport default Filters;\n"]},"metadata":{},"sourceType":"module"}